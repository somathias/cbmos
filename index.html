
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Welcome to CBMOS’ documentation! &#8212; CBMOS 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="cbmos package" href="cbmos.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="welcome-to-cbmos-documentation">
<h1>Welcome to CBMOS’ documentation!<a class="headerlink" href="#welcome-to-cbmos-documentation" title="Permalink to this headline">¶</a></h1>
<p>CBMOS is a Python framework for the numerical analysis of center-based models.
It focuses on flexibility and ease of use and is capable of simulating up
to a few thousand cells within a few seconds, or even up to 10,000 cells if GPU support
is available. CBMOS shines best for exploratory tasks and prototyping, for
instance when one wants to compare different sets of parameters or solvers. At
the moment, it implements most popular force functions, a few first and second-order
explicit solvers, and even one implicit solver. The following sections describe
how to run a simple simulation and illustrate what kind of convergence studies
can be performed with this package.</p>
</section>
<section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<section id="initial-condition">
<h2>Initial condition<a class="headerlink" href="#initial-condition" title="Permalink to this headline">¶</a></h2>
<p>Setting up the initial condition of a simulation is very simple, all you
need is create a list of cell objects. In this example we set up a
Cartesian grid of 25 cells. Each cell will immediately divides after the
simulation starts. We then define a simple plotting function to show the
current cell configuration.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">cbmos</span>
<span class="kn">import</span> <span class="nn">cbmos.force_functions</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="kn">import</span> <span class="nn">cbmos.solvers.euler_forward</span> <span class="k">as</span> <span class="nn">ef</span>
<span class="kn">import</span> <span class="nn">cbmos.cell</span> <span class="k">as</span> <span class="nn">cl</span>

<span class="n">n_x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">cell_size</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">cell_size</span><span class="o">*</span><span class="n">i_x</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">cell_size</span><span class="o">*</span><span class="n">i_y</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_y</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">sheet</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span>
        <span class="n">i</span><span class="p">,</span> <span class="c1"># Cell ID, must be unique to each cell</span>
        <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span> <span class="c1"># Initial coordinates</span>
        <span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="c1"># Birthtime, in this case 6 hours before the simulation starts</span>
        <span class="kc">True</span><span class="p">,</span> <span class="c1"># Whether or not the cell is proliferating</span>
        <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">t</span> <span class="c1"># Function generating the next division time</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_population</span><span class="p">(</span><span class="n">cell_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_list</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span> <span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cell</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_population</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/basic_example_3_0.png" src="_images/basic_example_3_0.png" />
</section>
<section id="simulation">
<h2>Simulation<a class="headerlink" href="#simulation" title="Permalink to this headline">¶</a></h2>
<p>In this simulation, we use the Gls force and the Euler forward solver.
The force function’s parameters are given to the simulate function as a
dictionary. Parameters can also be passed to the solver in the same way.
This function returns a tuple containing the time points and a list of
cells for each of these time points. If needed a detailed log of the
division events can be displayed by <a class="reference external" href="https://docs.python.org/3/howto/logging.html">setting the log
level</a> to <code class="docutils literal notranslate"><span class="pre">debug</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">cbmos</span><span class="o">.</span><span class="n">CBModel</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">Gls</span><span class="p">(),</span> <span class="n">ef</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">t_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

<span class="n">t_data</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span>
    <span class="n">sheet</span><span class="p">,</span> <span class="c1"># Initial cell configuration</span>
    <span class="n">t_data</span><span class="p">,</span> <span class="c1"># Times at which the history is saved</span>
    <span class="p">{</span><span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="mf">5.70</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;rA&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span> <span class="c1"># Force parameters</span>
    <span class="p">{</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="p">},</span> <span class="c1"># Solver parameters</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_population</span><span class="p">(</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<img alt="_images/basic_example_7_0.png" src="_images/basic_example_7_0.png" />
</section>
</section>
<section id="exploring-convergence">
<h1>Exploring Convergence<a class="headerlink" href="#exploring-convergence" title="Permalink to this headline">¶</a></h1>
<p>CBMOS is aimed at performing numerical studies of Center-Based
overlapping Spheres Models. In this section, we present a minimal
example to study the convergence of the Euler forward and
Adams-Bashforth methods for a few non-proliferating cells and for three
of the most popular force functions (namely GLS, Cubic and Piecewise
Quadratic) can be studied.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>After importing relevant modules, we set up the simulation parameters as
well as all three models (one per force function). Each model takes
three parameters: the force function to be used, the solver, and the
dimension of the model (usually 2 or 3). For this simple example, we
will use Euler Forward for all models.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cbmos</span>
<span class="kn">import</span> <span class="nn">cbmos.force_functions</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="kn">import</span> <span class="nn">cbmos.solvers.euler_forward</span> <span class="k">as</span> <span class="nn">ef</span>
<span class="kn">import</span> <span class="nn">cbmos.solvers.adams_bashforth</span> <span class="k">as</span> <span class="nn">ab</span>
<span class="kn">import</span> <span class="nn">cbmos.cell</span> <span class="k">as</span> <span class="nn">cl</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">sci</span>

<span class="c1"># Simulation parameters</span>
<span class="n">s</span> <span class="o">=</span> <span class="mf">1.0</span>    <span class="c1"># rest length</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">4.0</span>  <span class="c1"># final time</span>
<span class="n">rA</span> <span class="o">=</span> <span class="mf">1.5</span>   <span class="c1"># maximum interaction distance</span>
<span class="n">dim</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">forces</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cubic&#39;</span><span class="p">:</span><span class="n">ff</span><span class="o">.</span><span class="n">Cubic</span><span class="p">(),</span>
    <span class="s1">&#39;pw. quad.&#39;</span><span class="p">:</span><span class="n">ff</span><span class="o">.</span><span class="n">PiecewisePolynomial</span><span class="p">(),</span>
    <span class="s1">&#39;GLS&#39;</span><span class="p">:</span> <span class="n">ff</span><span class="o">.</span><span class="n">Gls</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">solvers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;EF&#39;</span><span class="p">:</span> <span class="n">ef</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">,</span>
    <span class="s1">&#39;AB&#39;</span><span class="p">:</span> <span class="n">ab</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">solver_name</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">force_name</span><span class="p">:</span> <span class="n">cbmos</span><span class="o">.</span><span class="n">CBModel</span><span class="p">(</span>
                             <span class="n">force</span><span class="p">,</span>
                             <span class="n">solver</span><span class="p">,</span>
                             <span class="n">dim</span><span class="p">,</span>
                         <span class="p">)</span>
            <span class="k">for</span> <span class="n">force_name</span><span class="p">,</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">solver_name</span><span class="p">,</span> <span class="n">solver</span> <span class="ow">in</span> <span class="n">solvers</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="initial-conditions">
<h2>Initial Conditions<a class="headerlink" href="#initial-conditions" title="Permalink to this headline">¶</a></h2>
<p>Then, we create a list a cells using a list of (x, y) coordinates. Each
cell takes at least 2 parameters: a (unique) id, and some coordinates.
Optional parameters can be used to define if and when each cell should
proliferate. In this example, and for the sake of simplicity, we will
only not use proliferation. Cells are set to be at 30% of their rest
lenght. Once the simulation is launched, the cells will push each other
and relax to a new configuration.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">npr</span>

<span class="n">n_x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">compactness</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">initial_sheet</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="n">compactness</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">compactness</span><span class="o">*</span><span class="n">y</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_x</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_y</span><span class="p">)])</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="model-parameters">
<h2>Model Parameters<a class="headerlink" href="#model-parameters" title="Permalink to this headline">¶</a></h2>
<p>The parameters of each force function can be set with a dictionnary
containing all keywords argument to be passed to the force functions. In
this case, the parameters are taken from [1], where they were set so
that the relaxation time between the cells is one hour.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params_cubic</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="mf">5.70</span><span class="p">,</span>
    <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span>
    <span class="s2">&quot;rA&quot;</span><span class="p">:</span> <span class="n">rA</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">muR</span> <span class="o">=</span> <span class="mf">9.1</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.21</span>
<span class="n">params_poly</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;muA&#39;</span><span class="p">:</span> <span class="n">ratio</span><span class="o">*</span><span class="n">muR</span><span class="p">,</span>
    <span class="s1">&#39;muR&#39;</span><span class="p">:</span> <span class="n">muR</span><span class="p">,</span>
    <span class="s1">&#39;rA&#39;</span><span class="p">:</span> <span class="n">rA</span><span class="p">,</span>
    <span class="s1">&#39;rR&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">),</span>
    <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">mu_gls</span><span class="o">=</span><span class="mf">1.95</span>
<span class="n">params_gls</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;mu&#39;</span><span class="p">:</span> <span class="n">mu_gls</span><span class="p">,</span>
    <span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.002</span><span class="o">/</span><span class="n">mu_gls</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="n">params_cubic</span><span class="p">,</span>
    <span class="s1">&#39;pw. quad.&#39;</span><span class="p">:</span> <span class="n">params_poly</span><span class="p">,</span>
    <span class="s1">&#39;GLS&#39;</span><span class="p">:</span> <span class="n">params_gls</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="reference-solutions">
<h2>Reference Solutions<a class="headerlink" href="#reference-solutions" title="Permalink to this headline">¶</a></h2>
<p>Here we compute the reference solutions for each force functions, using
fine timesteps. The <code class="docutils literal notranslate"><span class="pre">simulate</span></code> function takes the inital configuration
of the cell sheet, the time span over which to perform the simulation,
the parameters to be used for the force functions, and the parameters to
pass to the numerical solver.</p>
<p>In this case, since we are interested in measuring the error at the
timesteps used by the solver, we set <code class="docutils literal notranslate"><span class="pre">raw_t</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Otherwise,
the simulator would interpolate the position of the cells at the times
specified in <code class="docutils literal notranslate"><span class="pre">t_data_ref</span></code>. The exact timesteps used by the solver are
then returned along the history, containing the configurations of the
cells at each time point. In this example we convert this history into a
numpy array for efficiency.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_ref</span> <span class="o">=</span> <span class="mf">0.0005</span>

<span class="n">N_ref</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dt_ref</span><span class="o">*</span><span class="n">tf</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="n">t_data_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">dt_ref</span><span class="p">)</span>

<span class="n">ref_traj</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">solver</span> <span class="ow">in</span> <span class="n">solvers</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span>
        <span class="n">t_data_ref</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">solver</span><span class="p">][</span><span class="n">force</span><span class="p">]</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span>
            <span class="n">initial_sheet</span><span class="p">,</span>
            <span class="n">t_data_ref</span><span class="p">,</span>
            <span class="n">params</span><span class="p">[</span><span class="n">force</span><span class="p">],</span>
            <span class="p">{</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt_ref</span><span class="p">},</span>
            <span class="n">raw_t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ref_traj</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="p">{})[</span><span class="n">force</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_list</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">cell_list</span> <span class="ow">in</span> <span class="n">history</span>
            <span class="p">]</span>
        <span class="p">)</span> <span class="c1"># (N_ref, n_cells, dim)</span>
</pre></div>
</div>
</section>
<section id="error-computation">
<h2>Error computation<a class="headerlink" href="#error-computation" title="Permalink to this headline">¶</a></h2>
<p>We now compute the error between the reference solution and solutions
computed with coarser timesteps.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dt_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.001</span><span class="o">*</span><span class="mf">1.25</span><span class="o">**</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">)])</span>

<span class="n">sol</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">dt_values</span><span class="p">:</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="o">*</span><span class="n">tf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">t_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">solver</span> <span class="ow">in</span> <span class="n">solvers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span>
            <span class="n">t_data_sol</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">solver</span><span class="p">][</span><span class="n">force</span><span class="p">]</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span>
                <span class="n">initial_sheet</span><span class="p">,</span>
                <span class="n">t_data</span><span class="p">,</span>
                <span class="n">params</span><span class="p">[</span><span class="n">force</span><span class="p">],</span>
                <span class="p">{</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">dt</span><span class="p">},</span>
                <span class="n">raw_t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">traj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_list</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">cell_list</span> <span class="ow">in</span> <span class="n">history</span>
            <span class="p">])</span> <span class="c1"># (N, n_cells, dim)</span>
            <span class="n">interp</span> <span class="o">=</span> <span class="n">sci</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span>
                <span class="n">t_data_sol</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span>
                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">fill_value</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">traj</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:])</span>
            <span class="p">)(</span><span class="n">t_data_ref</span><span class="p">[:])</span>
            <span class="n">error</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                    <span class="n">interp</span> <span class="o">-</span> <span class="n">ref_traj</span><span class="p">[</span><span class="n">solver</span><span class="p">][</span><span class="n">force</span><span class="p">],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                    <span class="n">ref_traj</span><span class="p">[</span><span class="n">solver</span><span class="p">][</span><span class="n">force</span><span class="p">],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">sol</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="p">{})</span>\
                <span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">force</span><span class="p">,</span> <span class="p">[])</span>\
                <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="convergence-plot">
<h2>Convergence Plot<a class="headerlink" href="#convergence-plot" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;tableau-colorblind10&#39;</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
          <span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">6.75</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
          <span class="s1">&#39;lines.linewidth&#39;</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
         <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
         <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
         <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
         <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
          <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="s1">&#39;xx-large&#39;</span><span class="p">,</span>
         <span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
          <span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span>
          <span class="s2">&quot;mathtext.fontset&quot;</span><span class="p">:</span> <span class="s2">&quot;dejavuserif&quot;</span><span class="p">,</span>
         <span class="s1">&#39;axes.titlepad&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s1">&#39;axes.labelpad&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">defcolors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="n">defcolors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s1">&#39;pw. quad.&#39;</span><span class="p">:</span> <span class="n">defcolors</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
    <span class="s1">&#39;GLS&#39;</span><span class="p">:</span> <span class="n">defcolors</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">linestyles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pw. quad.&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="s1">&#39;GLS&#39;</span><span class="p">:</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">14.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">solver</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">solvers</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">force</span> <span class="ow">in</span> <span class="n">forces</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span>
            <span class="n">dt_values</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sol</span><span class="p">[</span><span class="n">solver</span><span class="p">][</span><span class="n">force</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">label</span><span class="o">=</span><span class="n">force</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">force</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="n">force</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\Delta t$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Euler Forward&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adams-Bashforth&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f(\Delta t)= \Delta t$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f(\Delta t)= \Delta t^2$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>


<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\epsilon_</span><span class="si">{rel}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/convergence_example_11_0.png" src="_images/convergence_example_11_0.png" />
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Mathias, S., Coulier, A., Bouchnita, A., &amp; Hellander, A. (2020).
Impact of force function formulations on the numerical simulation of
centre-based models. Bulletin of Mathematical Biology, 82(10), 1-43.</p></li>
</ol>
</section>
</section>
<section id="cbmos">
<h1>cbmos<a class="headerlink" href="#cbmos" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="cbmos.html">cbmos package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cbmos.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cbmos.cbmodel.html">cbmos.cbmodel package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cbmos.cbmodel.html#module-cbmos.cbmodel">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="cbmos.solvers.html">cbmos.solvers package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#module-cbmos.solvers.adams_bashforth">cbmos.solvers.adams_bashforth module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#module-cbmos.solvers.euler_backward">cbmos.solvers.euler_backward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#module-cbmos.solvers.euler_forward">cbmos.solvers.euler_forward module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#module-cbmos.solvers.heun">cbmos.solvers.heun module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#module-cbmos.solvers.midpoint">cbmos.solvers.midpoint module</a></li>
<li class="toctree-l4"><a class="reference internal" href="cbmos.solvers.html#module-cbmos.solvers">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cbmos.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="cbmos.html#module-cbmos.cell">cbmos.cell module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cbmos.html#module-cbmos.force_functions">cbmos.force_functions module</a></li>
<li class="toctree-l2"><a class="reference internal" href="cbmos.html#module-cbmos">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Welcome to CBMOS’ documentation!</a></li>
<li><a class="reference internal" href="#getting-started">Getting Started</a><ul>
<li><a class="reference internal" href="#initial-condition">Initial condition</a></li>
<li><a class="reference internal" href="#simulation">Simulation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#exploring-convergence">Exploring Convergence</a><ul>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#initial-conditions">Initial Conditions</a></li>
<li><a class="reference internal" href="#model-parameters">Model Parameters</a></li>
<li><a class="reference internal" href="#reference-solutions">Reference Solutions</a></li>
<li><a class="reference internal" href="#error-computation">Error computation</a></li>
<li><a class="reference internal" href="#convergence-plot">Convergence Plot</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cbmos">cbmos</a></li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Sonja Mathias, Adrien Coulier, Andreas Hellander.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>