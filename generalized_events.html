
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Implementing your own events &#8212; CBMOS 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="implementing-your-own-events">
<h1>Implementing your own events<a class="headerlink" href="#implementing-your-own-events" title="Permalink to this headline">¶</a></h1>
<p>Although the events we provide in this package are relatively limited,
CBMOS is designed to be flexible enough to use any event you wish to
implement.</p>
<p>New event can easily be implemented by deriving the abstract <code class="docutils literal notranslate"><span class="pre">Event</span></code>
class and overriding the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> and <code class="docutils literal notranslate"><span class="pre">apply</span></code> methods. As
mentionned in <code class="docutils literal notranslate"><span class="pre">Event</span></code> class’ documentation, the only requirement is
that the new subclass possesses an attribute <code class="docutils literal notranslate"><span class="pre">tau</span></code>, which represents
the time at which the event is triggered. The <code class="docutils literal notranslate"><span class="pre">apply</span></code> method takes an
object of type <code class="docutils literal notranslate"><span class="pre">CBModel</span></code> as unique parameter. This object contains all
the information about the current simulation and can be used to add,
modify and remove cells.</p>
<p>In this example, we implement two simple events: - <code class="docutils literal notranslate"><span class="pre">GlobalDeathEvent</span></code>
selects one cell at random and removes it from the simulation. -
<code class="docutils literal notranslate"><span class="pre">GlobalDivisionEvent</span></code> selects one cell at random and duplicates it.</p>
<p>Here, we set the simulation so that these events are triggered at
regular intervals. This mimics other cell-based software, where the
simulation is stopped at regular intervals to check if events have taken
place.</p>
<p>Although cell division and cell death can be implemented in many
different ways, depending of the complexity of the biological model. We
hope these examples illustrate how CBMOS can handle such a variety of
possibilities.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.random</span> <span class="k">as</span> <span class="nn">npr</span>

<span class="n">npr</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">cbmos.events</span> <span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span> <span class="nn">cbmos.cell</span> <span class="kn">import</span> <span class="n">Cell</span>

<span class="k">class</span> <span class="nc">GlobalDeathEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbmodel</span><span class="p">):</span>
        <span class="n">target_cell</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cbmodel</span><span class="o">.</span><span class="n">cell_list</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">cbmodel</span><span class="o">.</span><span class="n">cell_list</span><span class="p">[</span><span class="n">npr</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cbmodel</span><span class="o">.</span><span class="n">cell_list</span><span class="p">))]</span>

<span class="k">class</span> <span class="nc">GlobalDivisionEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>

    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbmodel</span><span class="p">):</span>
        <span class="n">target_cell</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cbmodel</span><span class="o">.</span><span class="n">cell_list</span><span class="p">)</span>

        <span class="n">division_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_division_direction</span><span class="p">(</span><span class="n">cbmodel</span><span class="p">)</span>
        <span class="n">updated_position_parent</span> <span class="o">=</span> <span class="n">target_cell</span><span class="o">.</span><span class="n">position</span> \
            <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cbmodel</span><span class="o">.</span><span class="n">separation</span> <span class="o">*</span> <span class="n">division_direction</span>
        <span class="n">position_daughter</span> <span class="o">=</span> <span class="n">target_cell</span><span class="o">.</span><span class="n">position</span> \
            <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cbmodel</span><span class="o">.</span><span class="n">separation</span> <span class="o">*</span> <span class="n">division_direction</span>

        <span class="n">daughter_cell</span> <span class="o">=</span> <span class="n">Cell</span><span class="p">(</span><span class="n">cbmodel</span><span class="o">.</span><span class="n">next_cell_index</span><span class="p">,</span> <span class="n">position_daughter</span><span class="p">)</span>
        <span class="n">cbmodel</span><span class="o">.</span><span class="n">next_cell_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cbmodel</span><span class="o">.</span><span class="n">cell_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">daughter_cell</span><span class="p">)</span>

        <span class="n">target_cell</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">updated_position_parent</span>

    <span class="k">def</span> <span class="nf">get_division_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cbmodel</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cbmodel</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">division_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>

        <span class="k">elif</span> <span class="n">cbmodel</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">random_angle</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">npr</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
            <span class="n">division_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">random_angle</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">random_angle</span><span class="p">)])</span>

        <span class="k">elif</span> <span class="n">cbmodel</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">npr</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
            <span class="n">random_azimuth_angle</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">u</span>
            <span class="n">random_zenith_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">division_direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">random_azimuth_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">random_zenith_angle</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">random_azimuth_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">random_zenith_angle</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">random_zenith_angle</span><span class="p">)])</span>

        <span class="k">return</span> <span class="n">division_direction</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">cbmos.cell</span> <span class="k">as</span> <span class="nn">cl</span>
<span class="kn">import</span> <span class="nn">cbmos.utils</span> <span class="k">as</span> <span class="nn">utils</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">t_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

<span class="n">n_x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n_y</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">generate_cartesian_coordinates</span><span class="p">(</span><span class="n">n_x</span><span class="p">,</span> <span class="n">n_y</span><span class="p">)</span>

<span class="n">sheet</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">cl</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span>
        <span class="n">i</span><span class="p">,</span> <span class="c1"># Cell ID, must be unique to each cell</span>
        <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">],</span> <span class="c1"># Initial coordinates</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">event_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">GlobalDivisionEvent</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
    <span class="n">GlobalDeathEvent</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cbmos</span>
<span class="kn">import</span> <span class="nn">cbmos.force_functions</span> <span class="k">as</span> <span class="nn">ff</span>
<span class="kn">import</span> <span class="nn">cbmos.solvers.euler_forward</span> <span class="k">as</span> <span class="nn">ef</span>

<span class="c1"># Initialize model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">cbmos</span><span class="o">.</span><span class="n">CBModel</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">Gls</span><span class="p">(),</span> <span class="n">ef</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_data</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span>
    <span class="n">sheet</span><span class="p">,</span> <span class="c1"># Initial cell configuration</span>
    <span class="n">t_data</span><span class="p">,</span> <span class="c1"># Times at which the history is saved</span>
    <span class="p">{</span><span class="s2">&quot;mu&quot;</span><span class="p">:</span> <span class="mf">5.70</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;rA&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span> <span class="c1"># Force parameters</span>
    <span class="p">{</span><span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">},</span> <span class="c1"># Solver parameters</span>
    <span class="n">event_list</span><span class="o">=</span><span class="n">event_list</span><span class="p">,</span>
    <span class="n">raw_t</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cells</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">history</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span>].add_patch(plt.Circle(cell.position, 0.5, color=color, alpha=0.4))
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span>].plot(cell.position[0], cell.position[1], &#39;.&#39;, color=color)
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span>].set_aspect(&#39;equal&#39;)
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span>].set_xlim(-2, 6.5)
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span>].set_ylim(-2.5, 7)
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="o">%</span><span class="k">3</span>].set_title(f&quot;t = {t_data[i]:.1f}&quot;)

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/generalized_events_6_0.png" src="_images/generalized_events_6_0.png" />
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Sonja Mathias, Adrien Coulier, Andreas Hellander.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/generalized_events.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>